<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Admin - Asociación XYZ</title>
  <link rel="stylesheet" href="admin.css" />
</head>
<body>
  <h1>Panel de Administración</h1>
  <form id="form-evento">
    <input type="text" name="titulo" placeholder="Título del evento" required />
    <textarea name="descripcion" placeholder="Descripción" required></textarea>
    <input type="file" name="imagen" />
    <button type="submit">Subir</button>
  </form>

  <script>
    document.getElementById("form-evento").addEventListener("submit", async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      const res = await fetch('/api/eventos', {
        method: 'POST',
        body: formData
      });
      alert('Evento subido');
      e.target.reset();
      cargarEventos();
    });
  
    async function cargarEventos() {
      const res = await fetch('/api/eventos');
      const eventos = await res.json();
      const contenedor = document.getElementById('lista-eventos');
      contenedor.innerHTML = '';
      eventos.forEach((ev, i) => {
        const div = document.createElement('div');
        div.innerHTML = `
          <p><strong>${ev.titulo}</strong>: ${ev.descripcion}</p>
          ${ev.imagen ? `<img src="${ev.imagen}" width="100" />` : ''}
          <button onclick="eliminarEvento(${i})">Eliminar</button>
          <hr/>
        `;
        contenedor.appendChild(div);
      });
    }
  
    async function eliminarEvento(index) {
      if (confirm("¿Seguro que deseas eliminar este evento?")) {
        await fetch(`/api/eventos/${index}`, { method: 'DELETE' });
        cargarEventos();
      }
    }
  
    // Crear contenedor
    const div = document.createElement('div');
    div.innerHTML = `<h2>Eventos existentes</h2><div id="lista-eventos"></div>`;
    document.body.appendChild(div);
  
    // Cargar eventos al cargar la página
    cargarEventos();
  </script>
</body>
</html>
